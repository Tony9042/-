<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>å¾Œå°ç®¡ç†ï½œå¤§è±è‡¨å¯¦æ¥­æœ‰é™å…¬å¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet" />
<style>
  :root{
    --primary:#4ad99b; --accent:#19a43b; --ink:#2b3a2e; --bg:#f6faf7;
    --card:#fff; --line:#e7efe9;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Open Sans','å¾®è»Ÿæ­£é»‘é«”',sans-serif;background:var(--bg);color:#2b2b2b}
  header{position:sticky;top:0;z-index:20;background:#19a43b;color:#fff;padding:16px 20px}
  header h1{margin:0;font-size:20px}
  main{max-width:1100px;margin:22px auto;padding:0 16px 60px}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 6px 16px #0000000c;margin-bottom:18px}
  .panel > h2{margin:0;padding:14px 16px;border-bottom:1px solid var(--line);font-size:18px;color:#1f3d1f;border-bottom-color:var(--line)}
  .panel .body{padding:16px}
  .hint{font-size:12px;color:#5c6f5f;margin:6px 0 0}
  label{font-weight:700;color:#1e3a1e}
  input[type="text"],input[type="email"],input[type="url"],textarea{
    width:100%;padding:10px;border:2px solid #cfe7d6;border-radius:8px;font:inherit
  }
  textarea{min-height:90px}
  input[type="file"]{display:block;margin:6px 0 10px}
  .btn{display:inline-flex;align-items:center;gap:6px;border:0;background:#19a43b;color:#fff;padding:9px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.ghost{background:#fff;color:#19a43b;border:2px solid #19a43b}
  .btn.danger{background:#d9534f}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
  .row-1{display:grid;grid-template-columns:1fr;gap:16px}
  .card{border:1px dashed #cfe5d6;border-radius:10px;padding:12px}
  .thumb{width:100%;height:180px;border-radius:10px;object-fit:cover;background:#f3f7f3;border:1px solid #e7efe9}
  .subtle{font-size:12px;color:#6c7b6c}
  hr.sep{border:0;border-top:1px dashed #deebdf;margin:14px 0}
  /* é¿å…æ¬„ä½äº’æ“ é‡ç–Š */
  .row, .row-3 { align-items:start; }
  .row > *, .row-3 > * { min-width:0; }
  /* å°è¢å¹•ç›´æ’ */
  @media(max-width:1024px){
    .row{grid-template-columns:1fr}
    .row-3{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<header>
  <h1>å¾Œå°ç®¡ç†ï½œå¤§è±è‡¨å¯¦æ¥­æœ‰é™å…¬å¸</h1>
</header>
<main>

  <!-- ç«™å°åŸºæœ¬ -->
  <section class="panel">
    <h2>ç«™å°åŸºæœ¬ï¼ˆLogo / Heroï¼‰</h2>
    <div class="body">

      <div class="row">
        <div class="card">
          <label>ç¶²ç«™ Logo åœ–ç‰‡</label>
          <img id="logoPrev" class="thumb" alt="Logo é è¦½"/>
          <input id="logoFile" type="file" accept="image/*">
          <div class="hint">é¸æ“‡åœ–ç‰‡æœƒè‡ªå‹•è½‰ç‚º Base64 å­˜å…¥ localStorageã€‚</div>
        </div>

        <div class="card">
          <label>Hero æ–‡å­—</label>
          <input id="heroTitle" type="text" placeholder="å¤§æ¨™é¡Œ">
          <input id="heroSub" type="text" placeholder="å‰¯æ¨™">
          <div class="row">
            <div>
              <label>CTA1 æ–‡å­—</label>
              <input id="cta1Text" type="text" placeholder="äº†è§£æˆ‘å€‘çš„æ•…äº‹">
              <label class="subtle">é€£çµ</label>
              <input id="cta1Href" type="text" placeholder="#story">
            </div>
            <div>
              <label>CTA2 æ–‡å­—</label>
              <input id="cta2Text" type="text" placeholder="æ¢ç´¢ç”¢å“æœå‹™">
              <label class="subtle">é€£çµ</label>
              <input id="cta2Href" type="text" placeholder="#offerings">
            </div>
          </div>
        </div>
      </div>

      <hr class="sep">

      <div class="card">
        <label>Hero å¹»ç‡ˆç‰‡ï¼ˆåœ–ç‰‡ï¼‰</label>
        <div id="slidesWrap" class="row-3"></div>
        <div class="btn-row">
          <button class="btn" id="addSlide">ï¼‹ æ–°å¢ä¸€å¼µ</button>
          <button class="btn ghost" id="resetSlides">é‡è¨­ç‚ºé è¨­ä¸‰å¼µ</button>
        </div>
      </div>

    </div>
  </section>

  <!-- å“ç‰Œæ•…äº‹ -->
  <section class="panel">
    <h2>å“ç‰Œæ•…äº‹</h2>
    <div class="body">
      <div class="row">
        <div>
          <label>å°èª</label>
          <textarea id="storyStrap"></textarea>
          <label>æ®µè½ä¸€</label>
          <textarea id="storyP1"></textarea>
          <label>æ®µè½äºŒ</label>
          <textarea id="storyP2"></textarea>
        </div>
        <div>
          <label>æ ¸å¿ƒåƒ¹å€¼ï¼ˆæ¯è¡Œä¸€æ¢ï¼Œå…±å››æ¢ï¼‰</label>
          <textarea id="storyValues" placeholder="å¾ªç’°ç¶“æ¿Ÿ&#10;åœŸå£¤å¥åº·&#10;ç’°å¢ƒä¿è­·&#10;ç¤¾æœƒé—œæ‡·"></textarea>
          <label>ä¸‰å¤§æ ¸å¿ƒï¼ˆæ¯è¡Œä¸€æ¢ï¼Œå…±ä¸‰æ¢ï¼‰</label>
          <textarea id="storyCore" placeholder="ç’°å¢ƒè²¬ä»»...&#10;å“è³ªä¿è­‰...&#10;ç¤¾æœƒé—œæ‡·..."></textarea>
        </div>
      </div>
    </div>
  </section>

  <!-- ç”¢å“èˆ‡æœå‹™ -->
  <section class="panel">
    <h2>ç”¢å“èˆ‡æœå‹™</h2>
    <div class="body">

      <!-- ç²¾é¸å€å¡Š -->
      <div class="card">
        <h3 style="margin:0 0 8px;color:#1e3a1e">ç²¾é¸å€å¡Šï¼ˆå¤§åœ–ï¼‹æ–‡å­—ï¼‰</h3>
        <div class="row">
          <div>
            <img id="featurePrev" class="thumb" alt="ç²¾é¸åœ–é è¦½"/>
            <input id="featureFile" type="file" accept="image/*">
            <div class="hint">ç•™ç©ºå°±ä¸æœƒé¡¯ç¤ºæ­¤å€å¡Šï¼ˆå‰å°æœƒè‡ªå‹•éš±è—ï¼‰ã€‚</div>
          </div>
          <div>
            <label>ç²¾é¸æ¨™é¡Œ</label>
            <input id="featureTitle" type="text" placeholder="ä¾‹å¦‚ï¼šå¾ªç’°è¾²æ¥­ç¤ºç¯„æ¡ˆå ´">
            <label>ç²¾é¸å…§æ–‡</label>
            <textarea id="featureText" placeholder="ç°¡è¿°æ­¤å°ˆæ¡ˆæˆ–ç”¢å“äº®é»..."></textarea>
          </div>
        </div>
      </div>

      <!-- ä¸‰å¼µç”¢å“å¡ï¼ˆA/B/Cï¼‰ -->
      <div class="row-3">
        <div class="card">
          <h3 style="margin:0 0 8px;color:#1e3a1e">ç”¢å“å¡ A</h3>
          <img id="cardAImgPrev" class="thumb" alt="å¡Aåœ–é è¦½"/>
          <input id="cardAImgFile" type="file" accept="image/*">
          <label>æ¨™é¡Œ</label><input id="cardATitle" type="text">
          <label>å‰¯æ¨™</label><input id="cardASub" type="text">
          <label>é‡é»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰</label><textarea id="cardABullets"></textarea>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px;color:#1e3a1e">ç”¢å“å¡ B</h3>
          <img id="cardBImgPrev" class="thumb" alt="å¡Båœ–é è¦½"/>
          <input id="cardBImgFile" type="file" accept="image/*">
          <label>æ¨™é¡Œ</label><input id="cardBTitle" type="text">
          <label>å‰¯æ¨™</label><input id="cardBSub" type="text">
          <label>é‡é»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰</label><textarea id="cardBBullets"></textarea>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px;color:#1e3a1e">ç”¢å“å¡ C</h3>
          <img id="cardCImgPrev" class="thumb" alt="å¡Cåœ–é è¦½"/>
          <input id="cardCImgFile" type="file" accept="image/*">
          <label>æ¨™é¡Œ</label><input id="cardCTitle" type="text">
          <label>å‰¯æ¨™</label><input id="cardCSub" type="text">
          <label>é‡é»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰</label><textarea id="cardCBullets"></textarea>
        </div>
      </div>

      <hr class="sep">

      <div class="card">
        <label>æµç¨‹ï¼ˆFlowï¼Œä¾åºï¼Œæ¯è¡Œä¸€é …ï¼‰</label>
        <textarea id="flowLines" placeholder="æœ‰æ©Ÿå»¢æ£„ç‰©&#10;å°ˆæ¥­è™•ç†&#10;ç¢³ç©©ç©©è‚¥æ–™&#10;è±æ”¶æˆæœ"></textarea>
      </div>

    </div>
  </section>

  <!-- æ–°è -->
  <section class="panel">
    <h2>æ¶ˆæ¯ä¸­å¿ƒï¼ˆå¯å¢åˆªï¼‰</h2>
    <div class="body">
      <div id="newsWrap" class="row"></div>
      <div class="btn-row">
        <button id="addNews" class="btn">ï¼‹ æ–°å¢ä¸€å‰‡</button>
        <button id="resetNews" class="btn ghost">é‡è¨­ç‚ºé è¨­ä¸‰å‰‡</button>
      </div>
    </div>
  </section>

  <!-- ESG èˆ‡å¤¥ä¼´ -->
  <section class="panel">
    <h2>ESG èˆ‡åˆä½œå¤¥ä¼´</h2>
    <div class="body">
      <div class="row">
        <div class="card">
          <h3 style="margin:0 0 8px">ESG æ¢ç›®ï¼ˆä¸‰å‰‡ï¼‰</h3>
          <div id="esgWrap" class="row-3"></div>
        </div>
        <div class="card">
          <h3 style="margin:0 0 8px">åˆä½œå¤¥ä¼´ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</h3>
          <textarea id="partnersLines" placeholder="åœ¨åœ°è¾²å ´&#10;ç¤¾å€çµ„ç¹”&#10;ç’°ä¿åœ˜é«”&#10;å­¸è¡“æ©Ÿæ§‹"></textarea>
        </div>
      </div>
    </div>
  </section>

  <!-- è¯çµ¡è³‡è¨Š -->
  <section class="panel">
    <h2>è¯çµ¡è³‡è¨Š</h2>
    <div class="body">
      <div class="row-3">
        <div>
          <label>é›»è©±</label><input id="phone" type="text" placeholder="+886-7-657-7151">
        </div>
        <div>
          <label>Email</label><input id="email" type="email" placeholder="info@dafengling.com">
        </div>
        <div>
          <label>åœ°å€</label><input id="addr" type="text" placeholder="å°ç£å°åŒ—å¸‚...">
        </div>
      </div>
      <div class="row">
        <div>
          <label>ç‡Ÿæ¥­æ™‚é–“ 1</label><input id="open1" type="text" placeholder="é€±ä¸€è‡³é€±äº”ï¼š09:00 - 18:00">
        </div>
        <div>
          <label>ç‡Ÿæ¥­æ™‚é–“ 2</label><input id="open2" type="text" placeholder="é€±å…­ï¼š09:00 - 12:00">
        </div>
      </div>
      <div class="row-1">
        <div>
          <label>ç‡Ÿæ¥­æ™‚é–“ 3</label><input id="open3" type="text" placeholder="é€±æ—¥ï¼šä¼‘æ¯">
        </div>
      </div>
    </div>
  </section>

  <!-- å„²å­˜ / åŒ¯å…¥ / åŒ¯å‡º -->
  <section class="panel">
    <h2>å„²å­˜è¨­å®š</h2>
    <div class="body">
      <div class="btn-row">
        <button id="saveAll" class="btn">ğŸ’¾ å„²å­˜è‡³ç€è¦½å™¨</button>
        <button id="exportAll" class="btn ghost">â¬‡ åŒ¯å‡º JSON</button>
        <label class="btn ghost" style="cursor:pointer">
          â¬† åŒ¯å…¥ JSON
          <input id="importFile" type="file" accept="application/json" style="display:none">
        </label>
        <button id="clearAll" class="btn danger">ğŸ—‘ æ¸…é™¤æ‰€æœ‰è‡ªè¨‚ï¼ˆå›åˆ°é è¨­ï¼‰</button>
      </div>
      <p class="hint">è³‡æ–™æœƒå­˜åœ¨ã€Œé€™å°è£ç½®çš„ç€è¦½å™¨ã€çš„ localStorageã€‚è¦æ›é›»è…¦æˆ–è¦éƒ¨ç½²åˆ°æ­£å¼ç«™ï¼Œå¯ç”¨ã€ŒåŒ¯å‡º/åŒ¯å…¥ JSONã€ã€‚</p>
    </div>
  </section>

</main>

<script>
/* ---------- åœ–ç‰‡å£“ç¸® / è®€æª” ---------- */
const readAsDataURL = file => new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); });
async function compressImage(file, maxW=1280, maxH=1280, quality=0.85){
  const img = new Image(); img.src = await readAsDataURL(file);
  await new Promise(r=> img.onload=r);
  let {width:w,height:h}=img, ratio=Math.min(maxW/w, maxH/h, 1);
  const c=document.createElement('canvas'); c.width=Math.round(w*ratio); c.height=Math.round(h*ratio);
  c.getContext('2d').drawImage(img,0,0,c.width,c.height);
  return c.toDataURL('image/jpeg', quality);
}

/* ---------- é è¨­è³‡æ–™ï¼ˆèˆ‡å‰å°ä¸€è‡´ï¼‰ ---------- */
const defaults = {
  logo: "https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=200&auto=format&fit=crop",
  hero: {
    title:"ç¨®ä¸‹ä¸€å€‹ç´„å®š è®“è±æ”¶é™è‡¨",
    sub:"è½‰å»¢ç‚ºèƒ½ï¼Œé»åœŸæˆé‡‘ã€‚èˆ‡åœŸåœ°å…±å‰µæ°¸çºŒå¾ªç’°çš„ç¾å¥½æœªä¾†ã€‚",
    cta1:{text:"äº†è§£æˆ‘å€‘çš„æ•…äº‹",href:"#story"},
    cta2:{text:"æ¢ç´¢ç”¢å“æœå‹™",href:"#offerings"},
    slides:[
      "https://images.pexels.com/photos/707915/pexels-photo-707915.jpeg",
      "https://images.pexels.com/photos/1438994/pexels-photo-1438994.jpeg",
      "https://images.pexels.com/photos/721991/pexels-photo-721991.jpeg"
    ]
  },
  story:{
    strap:"åœ¨ç¹è¯çš„éƒ½å¸‚è§’è½èˆ‡å»£è¢¤çš„ç”°é‡ä¹‹é–“ï¼Œæˆ‘å€‘å§‹çµ‚è¨˜å¾—èˆ‡åœŸåœ°æœ€åˆçš„ç´„å®š",
    p1:"æˆ‘å€‘çš„æ•…äº‹ï¼Œå§‹æ–¼å‰µè¾¦äººå°åœŸåœ°æœ€æ·±åˆ‡çš„ç–¼æƒœã€‚é¢å°é¤å»šå»¢æ£„ç‰©è¢«è¦–ç‚ºè² æ“”ã€å¾€ç„šåŒ–å ´æˆ–æ©åŸ‹å ´ä¸€é€”çš„ç¾æ³ï¼Œæˆ‘å€‘é¸æ“‡æ‰“é–‹ä¸€æ¢åŸæœ¬å»¢æ£„ä¹Ÿèƒ½å†ç”Ÿçš„å¾ªç’°è·¯ã€‚",
    p2:"æˆ‘å€‘å …ä¿¡ï¼šæ¸›ç¢³èˆ‡è±æ”¶ä¸å¿…äºŒé¸ä¸€ï¼Œç§‘æŠ€èƒ½èˆ‡è‡ªç„¶çš„å®Œæ•´çµåˆï¼Œè®“åœŸå£¤æ›´å¥åº·ã€ç¤¾æœƒæ›´æ°¸çºŒã€‚",
    values:["å»¢æ£„ç‰©è®Šæˆåšå€¼çš„è³‡æº","ç§‘æŠ€èˆ‡è‡ªç„¶çš„å®Œç¾çµåˆ","æ¸›å°‘ç¢³æ’æ”¾ï¼Œå›æ­¸æ–¼åœŸåœ°","å‰µé€ ç¶ è‰²å°±æ¥­èˆ‡æ©Ÿæœƒ"],
    core:["å°‡ç¢³å°å­˜æ–¼åœŸå£¤ä¸­ï¼Œè½å¯¦ç’°å¢ƒè²¬ä»»ã€‚","ç©©å®šåœŸå£¤å¥åº·ï¼Œæä¾›ä½œç‰©é•·æ•ˆç‡Ÿé¤Šã€‚","ä¸²é€£ç¤¾å€èˆ‡è¾²å ´ï¼Œå»ºç«‹å…±äº«ç”Ÿæ…‹åœˆã€‚"]
  },
  offerings:{
    feature:{ img:"", title:"", text:"" },
    cards:[
      {title:"ç¢³ç©©ç©©æœ‰æ©Ÿè³ªè‚¥æ–™", sub:"ç‚ºæ‚¨çš„é¤æ¡Œç©©ä½å¥åº·", img:"", bullets:["æ”¹å–„åœŸå£¤å¥åº·ï¼Œæä¾›é•·æ•ˆç‡Ÿé¤Š","é©ç”¨æ–¼è¾²ç”°èˆ‡å®¶åº­åœ’è—","å›ºç¢³æ¸›æ’ï¼Œæ‰“é€ æœƒå‘¼å¸çš„è¾²ç”°"]},
      {title:"æœ‰æ©Ÿå»¢æ£„ç‰©å›æ”¶æœå‹™", sub:"èˆ‰æ‰‹ä¹‹å‹ï¼Œæ°¸çºŒä¹‹é‘°", img:"", bullets:["ç¤¾å€åˆä½œï¼Œå»ºç«‹å…±å¥½ç”Ÿæ…‹åœˆ","å®Œæ•´å›æ”¶è™•ç†æµç¨‹","ä¿ƒé€²å¾ªç’°ç¶“æ¿Ÿï¼Œè³‡æºæ°¸çºŒåˆ©ç”¨"]},
      {title:"ï¼ˆç”¢å“å¡ C æ¨™é¡Œï¼‰", sub:"ï¼ˆç”¢å“å¡ C å‰¯æ¨™ï¼‰", img:"", bullets:["é‡é»1","é‡é»2","é‡é»3"]}
    ],
    flow:["æœ‰æ©Ÿå»¢æ£„ç‰©","å°ˆæ¥­è™•ç†","ç¢³ç©©ç©©è‚¥æ–™","è±æ”¶æˆæœ"]
  },
  news:[
    {tag:"å…¬å¸æ–°è",date:"2024å¹´3æœˆ15æ—¥",title:"å¤§è±è‡¨èˆ‡åœ¨åœ°è¾²å ´ç°½ç½²åˆä½œå”è­°",excerpt:"æ”œæ‰‹æ¨å‹•æœ‰æ©Ÿè¾²æ¥­ç™¼å±•ï¼Œå»ºç«‹æ°¸çºŒå¾ªç’°ç”Ÿæ…‹ç³»çµ±â€¦",link:"#"},
    {tag:"æˆæœåˆ†äº«",date:"2024å¹´3æœˆ10æ—¥",title:"ç¢³ç©©ç©©è‚¥æ–™åŠ©åŠ›è¾²å‹å¢ç”¢30%",excerpt:"ç¶“éä¸€å­£çš„ä½¿ç”¨ï¼Œåˆä½œè¾²å‹åæ˜ ä½œç‰©å“è³ªé¡¯è‘—æå‡â€¦",link:"#"},
    {tag:"æ´»å‹•è³‡è¨Š",date:"2024å¹´3æœˆ20æ—¥",title:"æ°¸çºŒè¾²æ¥­ç ”è¨æœƒå³å°‡èˆ‰è¾¦",excerpt:"é‚€è«‹å„ç•Œå°ˆå®¶å­¸è€…å…±åŒæ¢è¨å¾ªç’°è¾²æ¥­çš„æœªä¾†ç™¼å±•â€¦",link:"#"}
  ],
  esg:{
    items:[
      {abbr:"E",title:"ç’°å¢ƒï¼ˆEnvironmentalï¼‰",desc:"å›ºç¢³æ¸›æ’ã€æ¸›å°‘ç„šåŒ–æ©åŸ‹ï¼Œä¿ƒé€²å¾ªç’°ç¶“æ¿Ÿ"},
      {abbr:"S",title:"ç¤¾æœƒï¼ˆSocialï¼‰",desc:"å‰µé€ ç¶ è‰²å°±æ¥­ã€æ”¯æŒåœ¨åœ°è¾²æ¥­ï¼Œç¢ºä¿é£Ÿå“å®‰å…¨"},
      {abbr:"G",title:"æ²»ç†ï¼ˆGovernanceï¼‰",desc:"èª ä¿¡é€æ˜ã€æ°¸çºŒæ±ºç­–ã€è² è²¬ä»»çš„ä¼æ¥­ç¶“ç‡Ÿ"}
    ],
    partners:["åœ¨åœ°è¾²å ´","ç¤¾å€çµ„ç¹”","ç’°ä¿åœ˜é«”","å­¸è¡“æ©Ÿæ§‹"]
  },
  contact:{
    phone:"+886-7-657-7151",
    mail:"info@dafengling.com",
    addr:"å°ç£å°åŒ—å¸‚ä¿¡ç¾©å€æ°¸çºŒå¤§é“123è™Ÿ",
    open:["é€±ä¸€è‡³é€±äº”ï¼š09:00 - 18:00","é€±å…­ï¼š09:00 - 12:00","é€±æ—¥ï¼šä¼‘æ¯"]
  }
};

/* ---------- å°å·¥å…· ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function load(key, fallback){ try{ const raw=localStorage.getItem(key); return raw?JSON.parse(raw):structuredClone(fallback);}catch{return structuredClone(fallback);}}

/* ---------- UI å°å…ƒä»¶ ---------- */
function slideItem(url=""){
  const wrap=document.createElement('div');
  wrap.className='card';
  wrap.innerHTML=`
    <img class="thumb" alt="slide é è¦½">
    <input type="url" placeholder="æˆ–è²¼ä¸Šåœ–ç‰‡ç¶²å€">
    <input type="file" accept="image/*">
    <div class="btn-row"><button class="btn danger">åˆªé™¤æ­¤å¼µ</button></div>
  `;
  const img=wrap.querySelector('img.thumb');
  const urlInput=wrap.querySelector('input[type="url"]');
  const fileInput=wrap.querySelector('input[type="file"]');
  const delBtn=wrap.querySelector('.btn.danger');
  const setImg=src=>{ img.src=src||'https://via.placeholder.com/600x360?text=Slide'; urlInput.value=src||''; };
  setImg(url);
  fileInput.addEventListener('change', async e=>{ const f=e.target.files?.[0]; if(!f) return; setImg(await compressImage(f,1280,720,0.85)); });
  delBtn.onclick=()=>wrap.remove();
  return wrap;
}
function newsItem(item={tag:"",date:"",title:"",excerpt:"",link:"#"}){
  const card=document.createElement('div'); card.className='card';
  card.innerHTML=`
    <div class="row">
      <div><label>æ¨™ç±¤</label><input type="text" value="${item.tag||""}"></div>
      <div><label>æ—¥æœŸ</label><input type="text" value="${item.date||""}"></div>
    </div>
    <label>æ¨™é¡Œ</label><input type="text" value="${item.title||""}">
    <label>å…§æ–‡æ‘˜è¦</label><textarea>${item.excerpt||""}</textarea>
    <label>é€£çµ</label><input type="url" value="${item.link||"#"}">
    <div class="btn-row"><button class="btn danger">åˆªé™¤æ­¤å‰‡</button></div>
  `;
  card.querySelector('.btn.danger').onclick=()=>card.remove();
  return card;
}
function esgItem(item={abbr:"",title:"",desc:""}){
  const card=document.createElement('div'); card.className='card';
  card.innerHTML=`
    <label>ç¸®å¯«</label><input type="text" value="${item.abbr||""}" placeholder="E / S / G">
    <label>æ¨™é¡Œ</label><input type="text" value="${item.title||""}">
    <label>èªªæ˜</label><textarea>${item.desc||""}</textarea>
  `;
  return card;
}

/* ---------- å°‡è³‡æ–™å¡«å›è¡¨å–® ---------- */
function fillForm(){
  // logo
  const logo = localStorage.getItem('site.logo') || defaults.logo;
  $('#logoPrev').src = logo;

  // hero
  const hero = load('site.hero', defaults.hero);
  $('#heroTitle').value = hero.title || '';
  $('#heroSub').value   = hero.sub || '';
  $('#cta1Text').value  = hero.cta1?.text || '';
  $('#cta1Href').value  = hero.cta1?.href || '';
  $('#cta2Text').value  = hero.cta2?.text || '';
  $('#cta2Href').value  = hero.cta2?.href || '';

  // slides
  const slidesWrap=$('#slidesWrap'); slidesWrap.innerHTML='';
  (hero.slides?.length?hero.slides:defaults.hero.slides).forEach(u=>slidesWrap.appendChild(slideItem(u)));

  // story
  const story = load('site.story', defaults.story);
  $('#storyStrap').value = story.strap||'';
  $('#storyP1').value    = story.p1||'';
  $('#storyP2').value    = story.p2||'';
  $('#storyValues').value= (story.values||[]).join('\n');
  $('#storyCore').value  = (story.core||[]).join('\n');

  // offerings
  const offers = load('site.offerings', defaults.offerings);
  // feature
  $('#featurePrev').src   = (offers.feature?.img || '') || 'https://via.placeholder.com/800x480?text=Feature';
  $('#featureTitle').value= offers.feature?.title || '';
  $('#featureText').value = offers.feature?.text  || '';

  // cards A/B/C
  const A = offers.cards?.[0] || defaults.offerings.cards[0];
  const B = offers.cards?.[1] || defaults.offerings.cards[1];
  const C = offers.cards?.[2] || defaults.offerings.cards[2];

  $('#cardAImgPrev').src = A.img || 'https://via.placeholder.com/800x480?text=Card+A';
  $('#cardATitle').value = A.title||''; $('#cardASub').value = A.sub||'';
  $('#cardABullets').value = (A.bullets||[]).join('\n');

  $('#cardBImgPrev').src = B.img || 'https://via.placeholder.com/800x480?text=Card+B';
  $('#cardBTitle').value = B.title||''; $('#cardBSub').value = B.sub||'';
  $('#cardBBullets').value = (B.bullets||[]).join('\n');

  $('#cardCImgPrev').src = C.img || 'https://via.placeholder.com/800x480?text=Card+C';
  $('#cardCTitle').value = C.title||''; $('#cardCSub').value = C.sub||'';
  $('#cardCBullets').value = (C.bullets||[]).join('\n');

  // flow
  $('#flowLines').value = (offers.flow||[]).join('\n');

  // news
  const newsWrap = $('#newsWrap'); newsWrap.innerHTML='';
  const news = load('site.news', defaults.news);
  (news?.length?news:defaults.news).forEach(n=>newsWrap.appendChild(newsItem(n)));

  // esg
  const esg = load('site.esg', defaults.esg);
  const esgWrap = $('#esgWrap'); esgWrap.innerHTML='';
  (esg.items?.length?esg.items:defaults.esg.items).forEach(it=>esgWrap.appendChild(esgItem(it)));
  $('#partnersLines').value = (esg.partners||[]).join('\n');

  // contact
  const ci = load('site.contact', defaults.contact);
  $('#phone').value = ci.phone||''; $('#email').value = ci.mail||''; $('#addr').value = ci.addr||'';
  $('#open1').value = ci.open?.[0]||''; $('#open2').value = ci.open?.[1]||''; $('#open3').value = ci.open?.[2]||'';
}

/* ---------- æ”¶é›†è¡¨å–®ä¸¦å„²å­˜ ---------- */
async function saveAll(){
  // logo
  const logoFile = $('#logoFile').files?.[0];
  if(logoFile){ localStorage.setItem('site.logo', await compressImage(logoFile,512,512,0.9)); }

  // hero
  const hero = load('site.hero', defaults.hero);
  hero.title = $('#heroTitle').value.trim();
  hero.sub   = $('#heroSub').value.trim();
  hero.cta1  = { text: $('#cta1Text').value.trim(), href: $('#cta1Href').value.trim() || '#'};
  hero.cta2  = { text: $('#cta2Text').value.trim(), href: $('#cta2Href').value.trim() || '#'};
  hero.slides = $$('#slidesWrap .card').map(c=>c.querySelector('input[type="url"]').value.trim()).filter(Boolean);
  localStorage.setItem('site.hero', JSON.stringify(hero));

  // story
  const story = load('site.story', defaults.story);
  story.strap = $('#storyStrap').value.trim();
  story.p1    = $('#storyP1').value.trim();
  story.p2    = $('#storyP2').value.trim();
  story.values= $('#storyValues').value.split('\n').map(s=>s.trim()).filter(Boolean).slice(0,4);
  story.core  = $('#storyCore').value.split('\n').map(s=>s.trim()).filter(Boolean).slice(0,3);
  localStorage.setItem('site.story', JSON.stringify(story));

  // offerings
  const offers = load('site.offerings', defaults.offerings);
  // ä¿è­‰çµæ§‹å­˜åœ¨
  offers.feature = offers.feature || {img:"",title:"",text:""};
  offers.cards   = Array.isArray(offers.cards) ? offers.cards : [];
  while(offers.cards.length < 3) offers.cards.push({title:"",sub:"",img:"",bullets:[]});

  // feature
  const fFile = $('#featureFile').files?.[0];
  if(fFile){ offers.feature.img = await compressImage(fFile,1280,720,0.85); }
  offers.feature.title = $('#featureTitle').value.trim();
  offers.feature.text  = $('#featureText').value.trim();

  // card A
  const aFile = $('#cardAImgFile').files?.[0];
  if(aFile){ offers.cards[0].img = await compressImage(aFile,1280,720,0.85); }
  offers.cards[0].title   = $('#cardATitle').value.trim();
  offers.cards[0].sub     = $('#cardASub').value.trim();
  offers.cards[0].bullets = $('#cardABullets').value.split('\n').map(s=>s.trim()).filter(Boolean);

  // card B
  const bFile = $('#cardBImgFile').files?.[0];
  if(bFile){ offers.cards[1].img = await compressImage(bFile,1280,720,0.85); }
  offers.cards[1].title   = $('#cardBTitle').value.trim();
  offers.cards[1].sub     = $('#cardBSub').value.trim();
  offers.cards[1].bullets = $('#cardBBullets').value.split('\n').map(s=>s.trim()).filter(Boolean);

  // card C
  const cFile = $('#cardCImgFile').files?.[0];
  if(cFile){ offers.cards[2].img = await compressImage(cFile,1280,720,0.85); }
  offers.cards[2].title   = $('#cardCTitle').value.trim();
  offers.cards[2].sub     = $('#cardCSub').value.trim();
  offers.cards[2].bullets = $('#cardCBullets').value.split('\n').map(s=>s.trim()).filter(Boolean);

  // flow
  offers.flow = $('#flowLines').value.split('\n').map(s=>s.trim()).filter(Boolean);

  localStorage.setItem('site.offerings', JSON.stringify(offers));

  // news
  const news = $$('#newsWrap .card').map(c=>{
    const [tag,date] = c.querySelectorAll('.row input');
    const title = c.querySelector('label+input[type="text"]');
    const excerpt = c.querySelector('textarea');
    const link = c.querySelector('input[type="url"]');
    return { tag:tag.value.trim(), date:date.value.trim(), title:title.value.trim(), excerpt:excerpt.value.trim(), link:(link.value.trim()||"#") };
  }).filter(n=>n.title||n.excerpt||n.tag||n.date);
  localStorage.setItem('site.news', JSON.stringify(news.length?news:defaults.news));

  // esg
  const esg = load('site.esg', defaults.esg);
  esg.items = $$('#esgWrap .card').map(c=>{
    const [abbr,title] = c.querySelectorAll('input');
    const desc = c.querySelector('textarea');
    return { abbr:abbr.value.trim(), title:title.value.trim(), desc:desc.value.trim() };
  });
  esg.partners = $('#partnersLines').value.split('\n').map(s=>s.trim()).filter(Boolean);
  localStorage.setItem('site.esg', JSON.stringify(esg));

  // contact
  const contact = {
    phone: $('#phone').value.trim(),
    mail:  $('#email').value.trim(),
    addr:  $('#addr').value.trim(),
    open: [$('#open1').value.trim(), $('#open2').value.trim(), $('#open3').value.trim()]
  };
  localStorage.setItem('site.contact', JSON.stringify(contact));

  alert('âœ… å·²å„²å­˜åˆ°æœ¬æ©Ÿç€è¦½å™¨ï¼ˆlocalStorageï¼‰ã€‚å›å‰å°é‡æ–°æ•´ç†å³å¯çœ‹åˆ°ä¸‰å¼µå¡ç‰‡ã€‚');
}

/* ---------- åŒ¯å‡º / åŒ¯å…¥ / é è¨­æŒ‰éˆ• ---------- */
function exportAll(){
  const dump = {
    'site.logo': localStorage.getItem('site.logo') || defaults.logo,
    'site.hero': load('site.hero', defaults.hero),
    'site.story': load('site.story', defaults.story),
    'site.offerings': load('site.offerings', defaults.offerings),
    'site.news': load('site.news', defaults.news),
    'site.esg': load('site.esg', defaults.esg),
    'site.contact': load('site.contact', defaults.contact)
  };
  const blob = new Blob([JSON.stringify(dump,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='dafengling-site-data.json'; a.click();
}
function importAll(file){
  const r=new FileReader();
  r.onload=()=>{
    try{
      const data=JSON.parse(r.result);
      Object.entries(data).forEach(([k,v])=>{
        if(typeof v==='string' && k==='site.logo') localStorage.setItem(k,v);
        else localStorage.setItem(k, JSON.stringify(v));
      });
      fillForm();
      alert('âœ… åŒ¯å…¥å®Œæˆï¼Œè¨˜å¾—ã€Œå„²å­˜ã€ä¸€æ¬¡æˆ–ç›´æ¥å‰å°æŸ¥çœ‹ã€‚');
    }catch(e){ alert('åŒ¯å…¥å¤±æ•—ï¼šJSON æ ¼å¼ä¸æ­£ç¢º'); }
  };
  r.readAsText(file);
}
function resetSlides(){
  const hero = load('site.hero', defaults.hero);
  hero.slides = defaults.hero.slides.slice();
  localStorage.setItem('site.hero', JSON.stringify(hero));
  fillForm();
}
function resetNews(){
  localStorage.setItem('site.news', JSON.stringify(defaults.news));
  fillForm();
}

/* ---------- ç¶å®šäº‹ä»¶ ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  fillForm();

  // Logo
  $('#logoFile').addEventListener('change', async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    $('#logoPrev').src = await compressImage(f,512,512,0.9);
  });

  // Feature
  $('#featureFile').addEventListener('change', async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    $('#featurePrev').src = await compressImage(f,1280,720,0.85);
  });

  // Cards A/B/C
  $('#cardAImgFile').addEventListener('change', async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    $('#cardAImgPrev').src = await compressImage(f,1280,720,0.85);
  });
  $('#cardBImgFile').addEventListener('change', async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    $('#cardBImgPrev').src = await compressImage(f,1280,720,0.85);
  });
  $('#cardCImgFile').addEventListener('change', async e=>{
    const f=e.target.files?.[0]; if(!f) return;
    $('#cardCImgPrev').src = await compressImage(f,1280,720,0.85);
  });

  // Slides / News
  $('#addSlide').onclick = ()=> $('#slidesWrap').appendChild(slideItem(''));
  $('#resetSlides').onclick = resetSlides;
  $('#addNews').onclick = ()=> $('#newsWrap').appendChild(newsItem({}));
  $('#resetNews').onclick = resetNews;

  // Save / Export / Import / Clear
  $('#saveAll').onclick = saveAll;
  $('#exportAll').onclick = exportAll;
  $('#importFile').addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) importAll(f); e.target.value=''; });
  $('#clearAll').onclick = ()=>{
    if(confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è‡ªè¨‚è³‡æ–™ï¼Ÿï¼ˆlocalStorage å°‡æ¸…ç©ºï¼‰')){
      ['site.logo','site.hero','site.story','site.offerings','site.news','site.esg','site.contact'].forEach(k=>localStorage.removeItem(k));
      fillForm();
      alert('å·²æ¸…é™¤ï¼Œé é¢å›åˆ°é è¨­è³‡æ–™ã€‚');
    }
  };
});
</script>
</body>
</html>
